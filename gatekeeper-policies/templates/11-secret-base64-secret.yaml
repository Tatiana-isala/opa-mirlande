cat <<EOF | kubectl apply -f -
apiVersion: templates.gatekeeper.sh/v1beta1
kind: ConstraintTemplate
metadata:
  name: k8ssecretbase64encoded
spec:
  crd:
    spec:
      names:
        kind: K8sSecretBase64Encoded
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package k8ssecretbase64encoded

        violation[{"msg": msg}] {
          secret := input.review.object
          secret.kind == "Secret"
          value := secret.data[_]
          not is_base64(value)
          msg := "Secret data values must be base64 encoded"
        }

        is_base64(str) {
          regex.match("^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$", str)
        }
EOF
